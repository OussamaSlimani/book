<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Book Reader</title>
  <style>
    .book-container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #f9f9f9;
      margin-top: 20px;
    }

    h1 {
      text-align: center;
    }

    .word {
      margin-right: 5px;
      display: inline-block;
    }

    .copy-button {
      display: block;
      margin: 10px auto;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .copy-button:hover {
      background: #0056b3;
    }

    form {
      max-width: 600px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 20px;
    }

    input,
    textarea {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    textarea {
      resize: vertical;
    }

    button[type="submit"] {
      background-color: #28a745;
    }
    .custom-toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4caf50;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 1000;
  }
  .custom-toast.show {
    opacity: 1;
    transform: translateY(0);
  }
  </style>
</head>

<body>
  <form id="bookForm">
    <input type="text" id="title" placeholder="Book Title" required />
    <input type="text" id="id" placeholder="Book ID (e.g., book1)" required />
    <textarea id="content" rows="5" placeholder="Book Content" required></textarea>
    <button type="submit" class="copy-button">Submit</button>
  </form>

  <button id="copyButtonHTML" class="copy-button" style="display:none">Copy HTML</button>

  <div class="book-container" id="bookContainer" style="display: none">
    <h1 id="bookTitle"></h1>
    <div id="bookContent"></div>
  </div>

  <script>
    let bookData = null;

    document.getElementById("bookForm").addEventListener("submit", function (e) {
      e.preventDefault();

      bookData = {
        title: document.getElementById("title").value.trim(),
        id: document.getElementById("id").value.trim(),
        content: document.getElementById("content").value.trim(),
      };

      displayBook(bookData);
      document.getElementById("bookContainer").style.display = "block";
      document.getElementById("copyButtonHTML").style.display = "block";
      document.getElementById("copyButtonFormat").style.display = "block";
    });
    function displayBook(data) {
      document.getElementById("bookTitle").innerText = data.title;
      const contentDiv = document.getElementById("bookContent");
      contentDiv.innerHTML = "";

      // Normalize and clean input
      let raw = data.content.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

      // Combine broken lines into paragraphs
      raw = raw
        .split('\n')
        .reduce((acc, line) => {
          const trimmed = line.trim();
          if (trimmed === '') {
            acc.push('\n'); // true paragraph break
          } else {
            if (acc.length && acc[acc.length - 1] !== '\n') {
              acc[acc.length - 1] += ' ' + trimmed;
            } else {
              acc.push(trimmed);
            }
          }
          return acc;
        }, [])
        .join('\n');

      const paragraphs = raw.split('\n');

      paragraphs.forEach((para, paraIndex) => {
        const p = document.createElement("p");
        const words = para.trim().replace(/\s+/g, " ").split(" ");
        words.forEach((word, index) => {
          if (!word) return; // ðŸ›‘ Skip empty words
          const span = document.createElement("span");
          span.className = "word";
          span.id = `${data.id}_${paraIndex + 1}_${index + 1}`;
          span.innerText = word;
          p.appendChild(span);
          p.appendChild(document.createTextNode(" "));
        });
        if (p.hasChildNodes()) contentDiv.appendChild(p); // ðŸ›‘ Avoid appending empty <p>
      });
    }


    function showToast(message) {
    const toast = document.createElement("div");
    toast.className = "custom-toast";
    toast.textContent = message;
    document.body.appendChild(toast);

    // Force a reflow so the transition will run
    setTimeout(() => toast.classList.add("show"), 10);

    // Remove the toast after 3 seconds
    setTimeout(() => {
      toast.classList.remove("show");
      setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
  }

  function copyHTML() {
    const storyContainer = document.getElementById("bookContainer").outerHTML;
    const textarea = document.createElement("textarea");
    textarea.value = storyContainer;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand("copy");
    document.body.removeChild(textarea);
    showToast("HTML copied to clipboard!");
  }

    document.getElementById("copyButtonHTML").addEventListener("click", copyHTML);
  </script>
</body>

</html>